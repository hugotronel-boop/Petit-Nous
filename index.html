<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Petit Nous</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Styles g√©n√©raux */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
            background: linear-gradient(180deg, #fff7f2, #fdeee7);
            color: #3a2e2a;
            min-height: 100vh;
            transition: opacity 0.3s ease;
        }

        /* Bouton retour */
        .btn-retour {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            color: #3a2e2a;
            font-size: 15px;
            cursor: pointer;
            opacity: 0.7;
            z-index: 100;
            text-decoration: none;
            padding: 8px 12px;
        }

        .btn-retour:hover {
            opacity: 1;
        }

        /* Masquer les sections */
        .section {
            display: none;
            width: 100%;
            max-width: 390px;
            margin: 0 auto;
            padding: 24px;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Styles communs */
        h1 {
            font-family: "Pacifico", cursive;
            font-size: 46px;
            text-align: center;
            margin-bottom: 8px;
        }

        .subtitle {
            text-align: center;
            font-size: 15px;
            opacity: 0.75;
            margin-bottom: 32px;
        }

        .card {
            background: rgba(255, 255, 255, 0.65);
            border-radius: 26px;
            padding: 24px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
            backdrop-filter: blur(6px);
            margin-bottom: 20px;
        }

        label {
            font-size: 13px;
            margin-bottom: 6px;
            display: block;
            opacity: 0.8;
        }

        input, textarea, select {
            width: 100%;
            height: 52px;
            padding: 0 16px;
            border-radius: 18px;
            border: none;
            background: rgba(255, 255, 255, 0.8);
            font-size: 15px;
            margin-bottom: 16px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
            appearance: none;
        }

        textarea {
            height: 100px;
            padding: 16px;
            resize: vertical;
            min-height: 100px;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            background: white;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 20px;
            border: none;
            background: #e9a89b;
            color: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 8px 18px rgba(233,168,155,0.35);
            margin-bottom: 10px;
        }

        .btn-secondary {
            background: #fff;
            color: #3a2e2a;
            border: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .footer {
            text-align: center;
            font-size: 13px;
            opacity: 0.6;
            margin-top: 24px;
        }

        /* Code 1 sp√©cifique */
        #section1 .app {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Code 2 sp√©cifique */
        .progress-container {
            width: 100%;
            height: 14px;
            background: rgba(0,0,0,0.05);
            border-radius: 14px;
            margin: 14px 0 18px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: #e9a89b;
            border-radius: 14px;
            transition: width 0.5s;
        }

        .week, .due-date, .weeks-left, .baby-size, .tip {
            margin-bottom: 6px;
        }

        .week {
            font-size: 18px;
            font-weight: 500;
        }

        .due-date, .weeks-left, .baby-size {
            font-size: 14px;
            opacity: 0.7;
        }

        .tip {
            font-size: 13px;
            opacity: 0.65;
            margin-top: 10px;
        }

        .edit-section {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .edit-section input[type="date"] {
            padding: 10px 12px;
            border-radius: 14px;
            border: 1px solid rgba(0,0,0,0.1);
            font-size: 14px;
            width: auto;
        }

        .edit-section button {
            padding: 10px 16px;
            border-radius: 14px;
            border: none;
            background-color: #e9a89b;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        /* Code 3 sp√©cifique */
        .week-card {
            background: rgba(255,255,255,0.75);
            border-radius: 20px;
            padding: 12px 16px;
            margin-bottom: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.04);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
        }

        .week-number {
            font-weight: 500;
        }

        .week-month {
            opacity: 0.7;
            font-size: 13px;
        }

        .week-size {
            opacity: 0.8;
            font-size: 14px;
        }

        .trimester1 {
            border-left: 4px solid #e9a89b;
        }

        .trimester2 {
            border-left: 4px solid #f4c542;
        }

        .trimester3 {
            border-left: 4px solid #3a2e2a;
        }

        /* Code 4 sp√©cifique */
        #section4 .parents-text {
            opacity: 0.8;
            text-align: center;
            margin-bottom: 10px;
        }

        .add-souvenir {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .add-souvenir input, .add-souvenir button {
            width: 85%;
            padding: 10px;
            border-radius: 14px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        #photoPreview img {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
        }

        .souvenir {
            display: flex;
            gap: 10px;
            background: rgba(255,255,255,0.85);
            border-radius: 18px;
            padding: 14px;
            margin-bottom: 12px;
            align-items: center;
        }

        .souvenir img {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
        }

        .actions button {
            background: none;
            border: none;
            font-size: 13px;
            cursor: pointer;
            margin-right: 8px;
        }

        .edit {
            color: #3a2e2a;
        }

        .delete {
            color: #c0392b;
        }

        .souvenir-list {
            display: none;
            margin-top: 16px;
        }

        #imageModal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
        }

        #imageModal > div {
            background: #fff;
            border-radius: 14px;
            padding: 20px;
            max-width: 90%;
            margin: 50px auto;
            text-align: center;
        }

        #imageModal img {
            max-width: 100%;
            border-radius: 12px;
        }

        #imageModal button {
            margin-top: 12px;
            padding: 10px 16px;
            border: none;
            border-radius: 14px;
            background: #e9a89b;
            color: white;
            cursor: pointer;
        }

        #closeModal {
            background: #ccc;
            color: #333;
        }

        /* Code 5 sp√©cifique */
        .note-card {
            background: rgba(255,255,255,0.9);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
        }

        .note-card label {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .note-card .actions {
            display: flex;
            justify-content: space-between;
            gap: 4px;
        }
    </style>
</head>
<body>
    <!-- Section 1: Entr√©e des parents -->
    <section id="section1" class="section active">
        <div class="app">
            <h1>Petit Nous</h1>
            <div class="subtitle">
                Chaque histoire commence quelque part ü§ç
            </div>

            <div class="card">
                <label>‚ù§Ô∏è Pr√©nom(s) des parents</label>
                <input 
                    type="text" 
                    id="parentsName" 
                    placeholder="Ex : Hugo & Charline"
                />

                <button class="btn" onclick="saveParents()">
                    Commencer l'aventure ‚ú®
                </button>
            </div>

            <div class="footer">
                Un espace intime, juste pour vous.
            </div>
        </div>
    </section>

    <!-- Section 2: Menu principal -->
    <section id="section2" class="section">
        <div class="app">
            <div class="header">
                <h1>Petit Nous</h1>
                <div class="parents-text" id="parentsText"></div>
                <p>Chaque jour nous rapproche de toi</p>
            </div>

            <div class="card">
                <div class="week" id="weekText">Semaine 0</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="due-date" id="dueDateText">Terme estim√© : --</div>
                <div class="weeks-left" id="weeksLeftText">Encore -- semaines ü•∞</div>
                <div class="baby-size" id="babySize">B√©b√© est petit comme une graine üå±</div>
                <div class="tip" id="tipText">N'oubliez pas de prendre votre photo hebdo ü§ç</div>

                <div class="edit-section">
                    <button type="button" onclick="showEdit()">Modifier la date de d√©but</button>
                    <div id="editContainer" style="display:none;">
                        <input type="date" id="editDate" />
                        <button type="button" onclick="updateStartDate()">Valider</button>
                    </div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn btn-primary" onclick="showSection(4)">‚úçÔ∏è Ajouter un souvenir</button>
                <button class="btn btn-secondary" onclick="showSection(3)">üìÜ Voir la timeline</button>
                <button class="btn btn-secondary" onclick="showSection(5)">üìù Journal de grossesse</button>
            </div>

            <div class="footer">Un jour, tu liras tout √ßa ‚ù§Ô∏è</div>
        </div>
    </section>

    <!-- Section 3: Timeline -->
    <section id="section3" class="section">
        <button class="btn-retour" onclick="showSection(2)">Retour</button>
        <div class="app">
            <h1>Timeline</h1>
            <div id="timeline"></div>
        </div>
    </section>

    <!-- Section 4: Souvenirs -->
    <section id="section4" class="section">
        <button class="btn-retour" onclick="showSection(2)">Retour</button>
        <div class="app">
            <div class="header">
                <h1>Petit Nous</h1>
                <div class="parents-text" id="souvenirParentsText"></div>
                <p>Chaque moment compte üíõ</p>
            </div>

            <div class="card">
                <div class="add-souvenir">
                    <input id="souvenirText" placeholder="√âcris ton souvenir">
                    <input id="souvenirDate" type="date">
                    <input id="babySizeInput" type="number" placeholder="Taille b√©b√© (cm)">
                    <input id="souvenirPhoto" type="file" accept="image/*">
                    <div id="photoPreview"></div>
                    <button id="addButton">Ajouter le souvenir</button>
                </div>

                <button id="toggleButton" style="margin-top:12px;width:100%;">Lire les souvenirs</button>
                <button id="saveButton" style="margin-top:12px;width:100%;">Enregistrer s√©lection</button>

                <div id="souvenirList" class="souvenir-list"></div>
            </div>
        </div>

        <!-- Modal pour l'image -->
        <div id="imageModal">
            <div>
                <img id="modalImage">
                <div>
                    <button id="downloadImage">T√©l√©charger</button>
                    <button id="closeModal">Fermer</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 5: Journal -->
    <section id="section5" class="section">
        <button class="btn-retour" onclick="showSection(2)">Retour</button>
        <div class="app">
            <h1>üìù Journal de grossesse</h1>

            <div class="note-card">
                <label for="note">Notes libres :</label>
                <textarea id="note" placeholder="√âcris ce que vous ressentez..."></textarea>

                <label for="date">Date :</label>
                <input type="date" id="journalDate">

                <label for="emotion">Niveau d'√©motion :</label>
                <select id="emotion">
                    <option value="">-- Choisir --</option>
                    <option value="üòç">üòç Tr√®s heureux(se)</option>
                    <option value="üòä">üòä Heureux(se)</option>
                    <option value="üòê">üòê Neutre</option>
                    <option value="üòü">üòü Un peu inquiet(e)</option>
                    <option value="üò¢">üò¢ Triste</option>
                </select>

                <label for="author">Auteur :</label>
                <select id="author">
                    <option value="">-- Choisir --</option>
                    <option value="Hugo">Hugo</option>
                    <option value="Charline">Charline</option>
                    <option value="Nous deux">Nous deux</option>
                </select>

                <button id="saveNote">Ajouter au journal</button>
            </div>

            <div id="journal"></div>

            <div class="footer">Chaque √©motion compte ü§ç</div>
        </div>
    </section>

    <script>
        // Variables globales
        let startDate = null;
        let souvenirs = [];
        let editIndex = null;
        let currentPhoto = null;
        let journalEntries = [];

        // Tips pour la section 2
        const tips = [
            "N'oubliez pas de prendre votre photo hebdo ü§ç",
            "Cette semaine, b√©b√© bouge un peu plus ! üíÉ",
            "Hydratez-vous bien üíß",
            "Mangez une portion de fruits suppl√©mentaire üçé",
            "Profitez d'un moment calme ensemble üïäÔ∏è",
            "B√©b√© entend des sons, parlez-lui doucement üé∂",
            "C'est le moment parfait pour un peu de yoga doux üßò‚Äç‚ôÄÔ∏è",
            "Choisissez une chanson sp√©ciale pour b√©b√© üéµ",
            "Restez actif, m√™me une petite marche fait du bien üö∂‚Äç‚ôÇÔ∏è",
            "Pr√©parez votre coin cosy pour b√©b√© üçº"
        ];

        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            if (!localStorage.getItem('parentsName')) {
                showSection(1);
            } else {
                showSection(2);
            }
            initSection2();
            initSection3();
            initSection4();
            initSection5();
        });

        // Fonctions de navigation
        function showSection(sectionNumber) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`section${sectionNumber}`).classList.add('active');
            
            // Initialiser la section si n√©cessaire
            if (sectionNumber === 2) {
                initSection2();
            } else if (sectionNumber === 3) {
                initSection3();
            } else if (sectionNumber === 4) {
                initSection4();
            } else if (sectionNumber === 5) {
                initSection5();
            }
        }

        // Section 1: Entr√©e des parents
        function saveParents() {
            const parentsName = document.getElementById('parentsName').value;
            if (!parentsName) {
                alert('Ajoute le pr√©nom des parents ü§ç');
                return;
            }
            localStorage.setItem('parentsName', parentsName);
            showSection(2);
        }

        // Section 2: Menu principal
        function initSection2() {
            const parentsName = localStorage.getItem('parentsName') || 'Les parents';
            document.getElementById('parentsText').textContent = `${parentsName} attendent leur petit miracle ü•π`;
            
            startDate = localStorage.getItem('startDate') ? new Date(localStorage.getItem('startDate')) : null;
            
            if (startDate) {
                updatePregnancyInfo();
            }
        }

        function showEdit() {
            document.getElementById('editContainer').style.display = 'flex';
        }

        function updateStartDate() {
            const newDate = document.getElementById('editDate').value;
            if (!newDate) {
                alert('Choisis une date ü§ç');
                return;
            }
            startDate = new Date(newDate);
            localStorage.setItem('startDate', startDate.toISOString());
            document.getElementById('editContainer').style.display = 'none';
            updatePregnancyInfo();
        }

        function updatePregnancyInfo() {
            if (!startDate) return;

            const today = new Date();
            const diffTime = today - startDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const currentWeek = Math.max(1, Math.floor(diffDays / 7) + 1);

            document.getElementById('weekText').textContent = `Semaine ${currentWeek}`;

            // Barre de progression
            const progressPercent = Math.min(100, (currentWeek / 40) * 100);
            document.getElementById('progressBar').style.width = `${progressPercent}%`;

            const due = new Date(startDate.getTime() + 280 * 24 * 60 * 60 * 1000);
            document.getElementById('dueDateText').textContent = `Terme estim√© : ${due.toLocaleDateString('fr-FR')}`;

            const weeksLeft = Math.max(0, 40 - currentWeek);
            document.getElementById('weeksLeftText').textContent = `Encore ${weeksLeft} semaines ü•∞`;

            // Taille du b√©b√©
            const babySize = document.getElementById('babySize');
            if (currentWeek <= 4) babySize.textContent = 'B√©b√© est petit comme une graine üå±';
            else if (currentWeek <= 8) babySize.textContent = 'B√©b√© est grand comme une myrtille ü´ê';
            else if (currentWeek <= 12) babySize.textContent = 'B√©b√© est grand comme un kiwi ü•ù';
            else if (currentWeek <= 16) babySize.textContent = 'B√©b√© est grand comme un avocat ü•ë';
            else if (currentWeek <= 20) babySize.textContent = 'B√©b√© est grand comme une banane üçå';
            else if (currentWeek <= 24) babySize.textContent = 'B√©b√© est grand comme un √©pi de ma√Øs üåΩ';
            else if (currentWeek <= 28) babySize.textContent = 'B√©b√© est grand comme une aubergine üçÜ';
            else if (currentWeek <= 32) babySize.textContent = 'B√©b√© est grand comme une courgette ü•í';
            else if (currentWeek <= 36) babySize.textContent = 'B√©b√© est grand comme une papaye ü•≠';
            else babySize.textContent = 'B√©b√© est presque pr√™t ! üçº';

            // Tip hebdo
            const tipIndex = (currentWeek - 1) % tips.length;
            document.getElementById('tipText').textContent = tips[tipIndex];
        }

        // Section 3: Timeline
        function initSection3() {
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '';

            const babySizes = [
                0.1,0.2,0.4,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,
                22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40
            ];

            function getEmoji(size) {
                if (size <= 2) return 'üå±';
                if (size <= 5) return 'ü´ê';
                if (size <= 7) return 'ü•ù';
                if (size <= 11) return 'ü•ë';
                if (size <= 16) return 'üçå';
                if (size <= 25) return 'üåΩ';
                if (size <= 30) return 'üçÜ';
                if (size <= 35) return 'ü•í';
                if (size <= 40) return 'ü•≠';
                return 'üçº';
            }

            for (let week = 1; week <= 40; week++) {
                const card = document.createElement('div');
                card.className = 'week-card';
                
                if (week <= 12) card.classList.add('trimester1');
                else if (week <= 27) card.classList.add('trimester2');
                else card.classList.add('trimester3');

                let monthText = '';
                if (week % 4 === 1) {
                    const month = Math.ceil(week / 4);
                    monthText = `${month} mois`;
                }

                const size = babySizes[week - 1];
                const emoji = getEmoji(size);

                card.innerHTML = `
                    <div class="week-number">Semaine ${week}</div>
                    <div class="week-month">${monthText}</div>
                    <div class="week-size">${size} cm ${emoji}</div>
                `;
                timeline.appendChild(card);
            }
        }

        // Section 4: Souvenirs
        function initSection4() {
            const parentsName = localStorage.getItem('parentsName') || 'Les parents';
            document.getElementById('souvenirParentsText').textContent = `${parentsName} cr√©ent leurs souvenirs ü•π`;
            
            souvenirs = JSON.parse(localStorage.getItem('souvenirs')) || [];
            
            const souvenirPhoto = document.getElementById('souvenirPhoto');
            const photoPreview = document.getElementById('photoPreview');
            const addButton = document.getElementById('addButton');
            const toggleButton = document.getElementById('toggleButton');
            const saveButton = document.getElementById('saveButton');
            const souvenirList = document.getElementById('souvenirList');
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const downloadBtn = document.getElementById('downloadImage');
            const closeModal = document.getElementById('closeModal');

            souvenirPhoto.onchange = function() {
                const file = souvenirPhoto.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentPhoto = e.target.result;
                    photoPreview.innerHTML = `<img src="${currentPhoto}">`;
                };
                reader.readAsDataURL(file);
            };

            function sizeToEmoji(size) {
                if (!size) return '';
                if (size < 20) return 'üçì';
                if (size < 30) return 'üçê';
                if (size < 40) return 'üçä';
                return 'üë∂';
            }

            function renderSouvenirList() {
                souvenirList.innerHTML = '';
                souvenirs.forEach((s, index) => {
                    const div = document.createElement('div');
                    div.className = 'souvenir';

                    const check = document.createElement('input');
                    check.type = 'checkbox';
                    check.dataset.index = index;
                    div.appendChild(check);

                    if (s.photo) {
                        const img = document.createElement('img');
                        img.src = s.photo;
                        div.appendChild(img);
                    }

                    const content = document.createElement('div');
                    content.innerHTML = `
                        <div>${s.text}</div>
                        <div style="font-size:12px;opacity:.7">Taille : ${s.size || '?'} cm ${sizeToEmoji(s.size)}</div>
                        <div style="font-size:12px;opacity:.6">${s.date}</div>
                    `;

                    const actions = document.createElement('div');
                    actions.className = 'actions';

                    const editBtn = document.createElement('button');
                    editBtn.textContent = 'Modifier';
                    editBtn.className = 'edit';
                    editBtn.onclick = function() {
                        document.getElementById('souvenirText').value = s.text;
                        document.getElementById('souvenirDate').value = s.date;
                        document.getElementById('babySizeInput').value = s.size || '';
                        currentPhoto = s.photo;
                        photoPreview.innerHTML = s.photo ? `<img src="${s.photo}">` : '';
                        addButton.textContent = 'Mettre √† jour';
                        editIndex = index;
                    };

                    const delBtn = document.createElement('button');
                    delBtn.textContent = 'Supprimer';
                    delBtn.className = 'delete';
                    delBtn.onclick = function() {
                        if (confirm('Supprimer ce souvenir ?')) {
                            souvenirs.splice(index, 1);
                            localStorage.setItem('souvenirs', JSON.stringify(souvenirs));
                            renderSouvenirList();
                        }
                    };

                    actions.append(editBtn, delBtn);
                    content.appendChild(actions);
                    div.appendChild(content);
                    souvenirList.appendChild(div);
                });
            }

            addButton.onclick = function() {
                const text = document.getElementById('souvenirText').value;
                const date = document.getElementById('souvenirDate').value;
                const size = document.getElementById('babySizeInput').value;

                if (!text || !date) {
                    alert('Remplis tout ü§ç');
                    return;
                }

                const data = {
                    text: text,
                    date: date,
                    size: size,
                    photo: currentPhoto
                };

                if (editIndex !== null) {
                    souvenirs[editIndex] = data;
                    editIndex = null;
                    addButton.textContent = 'Ajouter le souvenir';
                } else {
                    souvenirs.push(data);
                }

                localStorage.setItem('souvenirs', JSON.stringify(souvenirs));

                document.getElementById('souvenirText').value = '';
                document.getElementById('souvenirDate').value = '';
                document.getElementById('babySizeInput').value = '';
                document.getElementById('souvenirPhoto').value = '';
                photoPreview.innerHTML = '';
                currentPhoto = null;

                renderSouvenirList();
            };

            toggleButton.onclick = function() {
                souvenirList.style.display = souvenirList.style.display === 'block' ? 'none' : 'block';
            };

            saveButton.onclick = async function() {
                const selected = Array.from(souvenirList.querySelectorAll('input[type=checkbox]:checked'));
                if (!selected.length) {
                    alert('S√©lectionne au moins un souvenir ü§ç');
                    return;
                }

                const exportBox = document.createElement('div');
                exportBox.style.position = 'fixed';
                exportBox.style.top = '-9999px';
                exportBox.style.width = '360px';
                exportBox.style.padding = '20px';
                exportBox.style.background = '#fff';

                selected.forEach(cb => {
                    const s = souvenirs[cb.dataset.index];
                    const block = document.createElement('div');
                    block.style.marginBottom = '16px';
                    block.style.border = '1px solid #ddd';
                    block.style.borderRadius = '12px';
                    block.style.padding = '12px';

                    if (s.photo) {
                        const img = document.createElement('img');
                        img.src = s.photo;
                        img.style.width = '100%';
                        img.style.borderRadius = '10px';
                        img.style.marginBottom = '8px';
                        block.appendChild(img);
                    }

                    block.innerHTML += `
                        <div>${s.text}</div>
                        <div style="font-size:13px;opacity:.7">Taille : ${s.size || '?'} cm ${sizeToEmoji(s.size)}</div>
                        <div style="font-size:12px;opacity:.6">${s.date}</div>
                    `;
                    exportBox.appendChild(block);
                });

                document.body.appendChild(exportBox);
                const canvas = await html2canvas(exportBox, { scale: 2, backgroundColor: '#fff' });
                document.body.removeChild(exportBox);

                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                modalImg.src = imgData;
                modal.style.display = 'block';

                downloadBtn.onclick = function() {
                    const a = document.createElement('a');
                    a.href = imgData;
                    a.download = 'souvenirs.jpeg';
                    a.click();
                };

                closeModal.onclick = function() {
                    modal.style.display = 'none';
                };
            };

            renderSouvenirList();
        }

        // Section 5: Journal
        function initSection5() {
            journalEntries = JSON.parse(localStorage.getItem('journalEntries')) || [];
            const saveButton = document.getElementById('saveNote');
            const journal = document.getElementById('journal');

            function createNoteCard(date, emotion, author, text, id) {
                const noteCard = document.createElement('div');
                noteCard.className = 'note-card';
                noteCard.dataset.id = id;

                noteCard.innerHTML = `
                    <div><strong>Date :</strong> <span class="date-text">${date}</span></div>
                    <div><strong>√âmotion :</strong> <span class="emotion-text">${emotion || '--'}</span></div>
                    <div><strong>Auteur :</strong> <span class="author-text">${author}</span></div>
                    <div class="note-text">${text}</div>
                    <div class="actions">
                        <button class="edit">Modifier</button>
                        <button class="delete">Supprimer</button>
                    </div>
                `;

                // Supprimer
                noteCard.querySelector('.delete').addEventListener('click', function() {
                    journalEntries = journalEntries.filter(entry => entry.id !== id);
                    localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                    noteCard.remove();
                });

                // Modifier
                noteCard.querySelector('.edit').addEventListener('click', function() {
                    document.getElementById('note').value = noteCard.querySelector('.note-text').innerText;
                    document.getElementById('journalDate').value = noteCard.querySelector('.date-text').innerText;
                    document.getElementById('emotion').value = noteCard.querySelector('.emotion-text').innerText;
                    document.getElementById('author').value = noteCard.querySelector('.author-text').innerText;

                    journalEntries = journalEntries.filter(entry => entry.id !== id);
                    localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                    noteCard.remove();
                });

                return noteCard;
            }

            function renderJournal() {
                journal.innerHTML = '';
                journalEntries.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(entry => {
                    const newNote = createNoteCard(
                        entry.date,
                        entry.emotion,
                        entry.author,
                        entry.text,
                        entry.id
                    );
                    journal.appendChild(newNote);
                });
            }

            saveButton.addEventListener('click', function() {
                const noteInput = document.getElementById('note');
                const dateInput = document.getElementById('journalDate');
                const emotionSelect = document.getElementById('emotion');
                const authorSelect = document.getElementById('author');

                if (!noteInput.value || !dateInput.value || !authorSelect.value) {
                    alert('Remplis la note, la date et l\'auteur ü§ç');
                    return;
                }

                const newEntry = {
                    id: Date.now(),
                    date: dateInput.value,
                    emotion: emotionSelect.value,
                    author: authorSelect.value,
                    text: noteInput.value
                };

                journalEntries.push(newEntry);
                localStorage.setItem('journalEntries', JSON.stringify(journalEntries));

                const newNote = createNoteCard(
                    newEntry.date,
                    newEntry.emotion,
                    newEntry.author,
                    newEntry.text,
                    newEntry.id
                );

                journal.prepend(newNote);

                // Reset
                noteInput.value = '';
                dateInput.value = '';
                emotionSelect.value = '';
                authorSelect.value = '';
            });

            renderJournal();
        }

        // Charger depuis le localStorage
        function loadFromStorage() {
            // Les donn√©es sont charg√©es dans chaque initSection
        }
    </script>
</body>
</html>
