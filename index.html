<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Petit Nous</title>

<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    background: linear-gradient(180deg, #fff7f2, #fdeee7);
    color: #3a2e2a;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .app {
    width: 100%;
    max-width: 390px;
    padding: 24px;
    box-sizing: border-box;
  }

  h1 {
    font-family: "Pacifico", cursive;
    font-size: 42px;
    text-align: center;
    margin-bottom: 8px;
  }

  .subtitle {
    text-align: center;
    font-size: 15px;
    opacity: 0.75;
    margin-bottom: 32px;
  }

  .card {
    background: rgba(255, 255, 255, 0.65);
    border-radius: 26px;
    padding: 24px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
    backdrop-filter: blur(6px);
  }

  label {
    font-size: 13px;
    margin-bottom: 6px;
    display: block;
    opacity: 0.8;
  }

  input, textarea, select {
    width: 100%;
    height: 52px;
    padding: 0 16px;
    border-radius: 18px;
    border: none;
    background: rgba(255, 255, 255, 0.8);
    font-size: 15px;
    margin-bottom: 16px;
    box-sizing: border-box;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
    appearance: none;
    -webkit-appearance: none;
  }

  textarea {
    height: 100px;
    padding: 16px;
    resize: vertical;
  }

  select {
    cursor: pointer;
  }

  input:focus, textarea:focus, select:focus {
    outline: none;
    background: white;
  }

  .btn {
    width: 100%;
    padding: 16px;
    border-radius: 20px;
    border: none;
    background: #e9a89b;
    color: white;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    box-shadow: 0 8px 18px rgba(233,168,155,0.35);
    margin-bottom: 12px;
  }

  .btn-secondary {
    background: #fff;
    color: #3a2e2a;
    border: 1px solid rgba(0, 0, 0, 0.06);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  }

  .footer {
    text-align: center;
    font-size: 13px;
    opacity: 0.6;
    margin-top: 24px;
  }

  .header {
    text-align: center;
    margin-bottom: 24px;
  }

  .header h1 {
    font-family: "Pacifico", cursive;
    font-size: 46px;
    margin: 0;
    letter-spacing: 1px;
    color: #3a2e2a;
  }

  .parents-text {
    font-size: 15px;
    opacity: 0.8;
    margin: 8px 0;
  }

  .week, .due-date, .weeks-left, .baby-size, .tip {
    margin-bottom: 6px;
  }

  .week {
    font-size: 18px;
    font-weight: 500;
  }

  .due-date, .weeks-left, .baby-size {
    font-size: 14px;
    opacity: 0.7;
  }

  .tip {
    font-size: 13px;
    opacity: 0.65;
    margin-top: 10px;
  }

  .progress-container {
    width: 100%;
    height: 14px;
    background: rgba(0,0,0,0.05);
    border-radius: 14px;
    margin: 14px 0 18px 0;
    overflow: hidden;
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background: #e9a89b;
    border-radius: 14px;
    transition: width 0.5s;
  }

  .edit-section {
    margin-top: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .edit-section input[type="date"] {
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,0.1);
    font-size: 14px;
  }

  .edit-section button {
    padding: 10px 16px;
    border-radius: 14px;
    border: none;
    background-color: #e9a89b;
    color: white;
    font-size: 14px;
    cursor: pointer;
  }

  .buttons {
    display: flex;
    flex-direction: column;
    gap: 14px;
    margin-top: 26px;
  }

  .week-card {
    background: rgba(255,255,255,0.75);
    border-radius: 20px;
    padding: 12px 16px;
    margin-bottom: 10px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.04);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 15px;
  }

  .week-number {
    font-weight: 500;
  }

  .week-month {
    opacity: 0.7;
    font-size: 13px;
  }

  .week-size {
    opacity: 0.8;
    font-size: 14px;
  }

  .trimester1 {
    border-left: 4px solid #e9a89b;
  }

  .trimester2 {
    border-left: 4px solid #f4c542;
  }

  .trimester3 {
    border-left: 4px solid #3a2e2a;
  }

  .add-souvenir {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
  }

  #photoPreview img {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    object-fit: cover;
  }

  .souvenir {
    display: flex;
    gap: 10px;
    background: rgba(255,255,255,0.85);
    border-radius: 18px;
    padding: 14px;
    margin-bottom: 12px;
    align-items: center;
  }

  .souvenir img {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    object-fit: cover;
  }

  .actions button {
    background: none;
    border: none;
    font-size: 13px;
    cursor: pointer;
    margin-right: 8px;
  }

  .edit {
    color: #3a2e2a;
  }

  .delete {
    color: #c0392b;
  }

  .souvenir-list {
    display: none;
    margin-top: 16px;
  }

  #imageModal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    z-index: 9999;
  }

  #imageModal > div {
    background: #fff;
    border-radius: 14px;
    padding: 20px;
    max-width: 90%;
    margin: 50px auto;
    text-align: center;
  }

  #imageModal img {
    max-width: 100%;
    border-radius: 12px;
  }

  #imageModal button {
    margin-top: 12px;
    padding: 10px 16px;
    border: none;
    border-radius: 14px;
    background: #e9a89b;
    color: white;
    cursor: pointer;
  }

  #closeModal {
    background: #ccc;
    color: #333;
  }

  .note-card {
    background: rgba(255,255,255,0.9);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: relative;
  }

  .note-card label {
    font-weight: 500;
    font-size: 14px;
    margin-bottom: 4px;
  }

  .note-card textarea,
  .note-card select,
  .note-card input[type="date"] {
    width: 100%;
    padding: 12px 14px;
    border-radius: 16px;
    border: 1px solid rgba(0,0,0,0.15);
    font-size: 14px;
    box-sizing: border-box;
    background: rgba(255,255,255,0.95);
    color: #3a2e2a;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    cursor: pointer;
    min-height: 44px;
    line-height: 20px;
    resize: vertical;
  }

  .note-card input[type="date"]::-webkit-inner-spin-button,
  .note-card input[type="date"]::-webkit-clear-button {
    -webkit-appearance: none;
    display: none;
  }

  .note-card button {
    width: 48%;
    padding: 12px;
    border-radius: 16px;
    border: none;
    background: #e9a89b;
    color: white;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: 0.2s;
  }

  .note-card button:hover {
    opacity: 0.9;
  }

  .note-card .actions {
    display: flex;
    justify-content: space-between;
    gap: 4px;
  }

  .page {
    display: none;
  }

  .page.active {
    display: block;
  }

  .back-btn {
    background: rgba(255, 255, 255, 0.7);
    border: none;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 10;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .back-btn:hover {
    background: rgba(255, 255, 255, 0.9);
  }
</style>
</head>

<body>
<div class="app">
  <!-- Page 1: D√©marrage -->
  <div id="page1" class="page active">
    <h1>Petit Nous</h1>
    <div class="subtitle">
      Chaque histoire commence quelque part ü§ç
    </div>

    <div class="card">
      <label>‚ù§Ô∏è Pr√©nom(s) des parents</label>
      <input 
        type="text" 
        id="parentsName" 
        placeholder="Ex : Hugo & Charline"
      />

      <button class="btn" onclick="saveParentsName()">
        Commencer l'aventure ‚ú®
      </button>
    </div>

    <div class="footer">
      Un espace intime, juste pour vous.
    </div>
  </div>

  <!-- Page 2: Accueil -->
  <div id="page2" class="page">
    <button class="back-btn" onclick="goBack()">‚Üê</button>
    
    <div class="header">
      <h1>Petit Nous</h1>
      <div class="parents-text" id="parentsText">Hugo & Charline attendent leur petit miracle ü•π</div>
      <p>Chaque jour nous rapproche de toi</p>
    </div>

    <div class="card">
      <div class="week" id="weekText">Semaine 0</div>
      <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
      <div class="due-date" id="dueDateText">Terme estim√© : --</div>
      <div class="weeks-left" id="weeksLeftText">Encore -- semaines ü•∞</div>
      <div class="baby-size" id="babySize">B√©b√© est petit comme une graine üå±</div>
      <div class="tip" id="tipText">N'oubliez pas de prendre votre photo hebdo ü§ç</div>

      <div class="edit-section">
        <button type="button" onclick="showEdit()">Modifier la date de d√©but</button>
        <div id="editContainer" style="display:none;">
          <input type="date" id="editDate" />
          <button type="button" onclick="updateStartDate()">Valider</button>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button class="btn" onclick="showPage('page4')">‚úçÔ∏è Ajouter un souvenir</button>
      <button class="btn btn-secondary" onclick="showPage('page3')">üìÜ Voir la timeline</button>
      <button class="btn btn-secondary" onclick="showPage('page5')">üìù Journal de grossesse</button>
    </div>

    <div class="footer">Un jour, tu liras tout √ßa ‚ù§Ô∏è</div>
  </div>

  <!-- Page 3: Timeline -->
  <div id="page3" class="page">
    <button class="back-btn" onclick="showPage('page2')">‚Üê</button>
    
    <h1>Timeline</h1>
    <div id="timeline"></div>
  </div>

  <!-- Page 4: Souvenirs -->
  <div id="page4" class="page">
    <button class="back-btn" onclick="showPage('page2')">‚Üê</button>
    
    <div class="header">
      <h1>Petit Nous</h1>
      <div class="parents-text" id="souvenirParentsText">Hugo & Charline cr√©ent leurs souvenirs ü•π</div>
      <p>Chaque moment compte üíõ</p>
    </div>

    <div class="card">
      <div class="add-souvenir">
        <input id="souvenirText" placeholder="√âcris ton souvenir">
        <input id="souvenirDate" type="date">
        <input id="babySizeInput" type="number" placeholder="Taille b√©b√© (cm)">
        <input id="souvenirPhoto" type="file" accept="image/*">
        <div id="photoPreview"></div>
        <button id="addButton">Ajouter le souvenir</button>
      </div>

      <button id="toggleButton" class="btn btn-secondary" style="margin-top:12px;">Lire les souvenirs</button>
      <button id="saveButton" class="btn" style="margin-top:12px;">Enregistrer s√©lection</button>

      <div id="souvenirList" class="souvenir-list"></div>
    </div>

    <!-- MODAL -->
    <div id="imageModal">
      <div>
        <img id="modalImage">
        <div>
          <button id="downloadImage">T√©l√©charger</button>
          <button id="closeModal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Page 5: Journal -->
  <div id="page5" class="page">
    <button class="back-btn" onclick="showPage('page2')">‚Üê</button>
    
    <h1>üìù Journal de grossesse</h1>

    <div class="note-card">
      <label for="note">Notes libres :</label>
      <textarea id="note" placeholder="√âcris ce que vous ressentez..."></textarea>

      <label for="date">Date :</label>
      <input type="date" id="journalDate">

      <label for="emotion">Niveau d'√©motion :</label>
      <select id="emotion">
        <option value="">-- Choisir --</option>
        <option value="üòç">üòç Tr√®s heureux(se)</option>
        <option value="üòä">üòä Heureux(se)</option>
        <option value="üòê">üòê Neutre</option>
        <option value="üòü">üòü Un peu inquiet(e)</option>
        <option value="üò¢">üò¢ Triste</option>
      </select>

      <label for="author">Auteur :</label>
      <select id="author">
        <option value="">-- Choisir --</option>
        <option value="Hugo">Hugo</option>
        <option value="Charline">Charline</option>
        <option value="Nous deux">Nous deux</option>
      </select>

      <button id="saveNote">Ajouter au journal</button>
    </div>

    <div id="journal"></div>

    <div class="footer">Chaque √©motion compte ü§ç</div>
  </div>
</div>

<script>
  // Variables globales
  let currentPage = 'page1';
  let startDate = null;
  let souvenirs = [];
  let editIndex = null;
  let currentPhoto = null;
  let journalEntries = [];
  
  const tips = [
    "N'oubliez pas de prendre votre photo hebdo ü§ç",
    "Cette semaine, b√©b√© bouge un peu plus ! üíÉ",
    "Hydratez-vous bien üíß",
    "Mangez une portion de fruits suppl√©mentaire üçé",
    "Profitez d'un moment calme ensemble üïäÔ∏è",
    "B√©b√© entend des sons, parlez-lui doucement üé∂",
    "C'est le moment parfait pour un peu de yoga doux üßò‚Äç‚ôÄÔ∏è",
    "Choisissez une chanson sp√©ciale pour b√©b√© üéµ",
    "Restez actif, m√™me une petite marche fait du bien üö∂‚Äç‚ôÇÔ∏è",
    "Pr√©parez votre coin cosy pour b√©b√© üçº"
  ];

  // Initialisation au chargement
  window.onload = function() {
    loadFromLocalStorage();
    initMainPage();
    initSouvenirsPage();
    initTimelinePage();
    initJournalPage();
    
    // Si des parents sont d√©j√† enregistr√©s, aller directement √† la page principale
    const parentsName = localStorage.getItem("parentsName");
    const startDateStr = localStorage.getItem("startDate");
    
    if (parentsName && startDateStr) {
      showPage('page2');
    } else {
      showPage('page1');
    }
  };

  // Fonctions de navigation
  function showPage(pageId) {
    // Cacher toutes les pages
    document.querySelectorAll('.page').forEach(page => {
      page.classList.remove('active');
    });
    
    // Afficher la page demand√©e
    document.getElementById(pageId).classList.add('active');
    currentPage = pageId;
    
    // Mettre √† jour les donn√©es si n√©cessaire
    if (pageId === 'page2') {
      initMainPage();
    } else if (pageId === 'page3') {
      initTimelinePage();
    } else if (pageId === 'page4') {
      updateSouvenirParentsText();
      renderSouvenirList();
    }
  }

  function goBack() {
    if (currentPage === 'page2') {
      showPage('page1');
    } else if (['page3', 'page4', 'page5'].includes(currentPage)) {
      showPage('page2');
    }
  }

  // Page 1: D√©marrage
  function saveParentsName() {
    const parentsName = document.getElementById("parentsName").value;

    if (!parentsName) {
      alert("Ajoute le pr√©nom des parents ü§ç");
      return;
    }

    // Stockage dans localStorage
    localStorage.setItem("parentsName", parentsName);
    
    // Demander la date de d√©but si pas encore d√©finie
    if (!localStorage.getItem("startDate")) {
      const today = new Date();
      const defaultDate = new Date(today.getTime() - 7*24*60*60*1000); // Il y a 7 jours
      const dateStr = defaultDate.toISOString().split('T')[0];
      localStorage.setItem("startDate", dateStr);
    }

    showPage('page2');
  }

  // Page 2: Accueil principal
  function initMainPage() {
    const parentsName = localStorage.getItem("parentsName") || "Hugo & Charline";
    document.getElementById("parentsText").textContent = parentsName + " attendent leur petit miracle ü•π";
    
    const startDateStr = localStorage.getItem("startDate");
    if (startDateStr) {
      startDate = new Date(startDateStr);
      document.getElementById("editDate").value = startDateStr;
      updatePregnancyInfo();
    }
  }

  function showEdit() {
    document.getElementById("editContainer").style.display = "flex";
  }

  function updateStartDate() {
    const newDate = document.getElementById("editDate").value;
    if (!newDate) return alert("Choisis une date ü§ç");

    startDate = new Date(newDate);
    localStorage.setItem("startDate", newDate);
    document.getElementById("editContainer").style.display = "none";
    updatePregnancyInfo();
  }

  function updatePregnancyInfo() {
    if (!startDate) return;

    const today = new Date();
    const diffTime = today - startDate;
    const diffDays = Math.floor(diffTime / (1000*60*60*24));
    const currentWeek = Math.max(1, Math.floor(diffDays / 7) + 1);

    document.getElementById("weekText").textContent = "Semaine " + currentWeek;

    // Barre de progression
    const progressPercent = Math.min(100, (currentWeek / 40) * 100);
    document.getElementById("progressBar").style.width = progressPercent + "%";

    const due = new Date(startDate.getTime() + 280*24*60*60*1000);
    document.getElementById("dueDateText").textContent = "Terme estim√© : " + due.toLocaleDateString('fr-FR');

    const weeksLeft = Math.max(0, 40 - currentWeek);
    document.getElementById("weeksLeftText").textContent = "Encore " + weeksLeft + " semaines ü•∞";

    // Emoji b√©b√©
    const babySize = document.getElementById("babySize");
    if (currentWeek <= 4) babySize.textContent = "B√©b√© est petit comme une graine üå±";
    else if (currentWeek <= 8) babySize.textContent = "B√©b√© est grand comme une myrtille ü´ê";
    else if (currentWeek <= 12) babySize.textContent = "B√©b√© est grand comme un kiwi ü•ù";
    else if (currentWeek <= 16) babySize.textContent = "B√©b√© est grand comme un avocat ü•ë";
    else if (currentWeek <= 20) babySize.textContent = "B√©b√© est grand comme une banane üçå";
    else if (currentWeek <= 24) babySize.textContent = "B√©b√© est grand comme un √©pi de ma√Øs üåΩ";
    else if (currentWeek <= 28) babySize.textContent = "B√©b√© est grand comme une aubergine üçÜ";
    else if (currentWeek <= 32) babySize.textContent = "B√©b√© est grand comme une courgette ü•í";
    else if (currentWeek <= 36) babySize.textContent = "B√©b√© est grand comme une papaye ü•≠";
    else babySize.textContent = "B√©b√© est presque pr√™t ! üçº";

    // Tip hebdo (cycle sur le tableau)
    const tipIndex = (currentWeek - 1) % tips.length;
    document.getElementById("tipText").textContent = tips[tipIndex];
  }

  // Page 3: Timeline
  function initTimelinePage() {
    const timeline = document.getElementById('timeline');
    timeline.innerHTML = '';
    
    // Exemple de tailles pour chaque semaine (cm)
    const babySizes = [
      0.1,0.2,0.4,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,
      22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40
    ];

    function getEmoji(size){
      if(size <= 2) return "üå±";
      if(size <= 5) return "ü´ê";
      if(size <= 7) return "ü•ù";
      if(size <= 11) return "ü•ë";
      if(size <= 16) return "üçå";
      if(size <= 25) return "üåΩ";
      if(size <= 30) return "üçÜ";
      if(size <= 35) return "ü•í";
      if(size <= 40) return "ü•≠";
      return "üçº";
    }

    for (let week = 1; week <= 40; week++) {
      const card = document.createElement('div');
      card.className = 'week-card';
      
      // Trimestres
      if (week <= 12) card.classList.add('trimester1');
      else if (week <= 27) card.classList.add('trimester2');
      else card.classList.add('trimester3');

      // Affichage du mois seulement au d√©but de chaque mois
      let monthText = "";
      if (week % 4 === 1) {
        const month = Math.ceil(week / 4);
        monthText = `${month} mois`;
      }

      const size = babySizes[week-1];
      const emoji = getEmoji(size);

      card.innerHTML = `<div class="week-number">Semaine ${week}</div>
                        <div class="week-month">${monthText}</div>
                        <div class="week-size">${size} cm ${emoji}</div>`;
      timeline.appendChild(card);
    }
  }

  // Page 4: Souvenirs
  function initSouvenirsPage() {
    const souvenirPhoto = document.getElementById("souvenirPhoto");
    const photoPreview = document.getElementById("photoPreview");
    const addButton = document.getElementById("addButton");
    const toggleButton = document.getElementById("toggleButton");
    const saveButton = document.getElementById("saveButton");
    
    souvenirPhoto.onchange = () => {
      const file = souvenirPhoto.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        currentPhoto = e.target.result;
        photoPreview.innerHTML = `<img src="${currentPhoto}">`;
      };
      reader.readAsDataURL(file);
    };

    addButton.onclick = addSouvenir;
    toggleButton.onclick = toggleSouvenirList;
    saveButton.onclick = saveSouvenirsSelection;
    
    // Initialiser les souvenirs depuis localStorage
    const savedSouvenirs = localStorage.getItem("souvenirs");
    if (savedSouvenirs) {
      souvenirs = JSON.parse(savedSouvenirs);
    }
    
    // Modal
    const modal = document.getElementById("imageModal");
    const modalImg = document.getElementById("modalImage");
    const downloadBtn = document.getElementById("downloadImage");
    const closeModal = document.getElementById("closeModal");
    
    downloadBtn.onclick = downloadImage;
    closeModal.onclick = () => modal.style.display = "none";
  }

  function updateSouvenirParentsText() {
    const parentsName = localStorage.getItem("parentsName") || "Hugo & Charline";
    document.getElementById("souvenirParentsText").textContent = parentsName + " cr√©ent leurs souvenirs ü•π";
  }

  function sizeToEmoji(size){
    if(!size) return '';
    if(size < 20) return 'üçì';
    if(size < 30) return 'üçê';
    if(size < 40) return 'üçä';
    return 'üë∂';
  }

  function renderSouvenirList(){
    const souvenirList = document.getElementById("souvenirList");
    souvenirList.innerHTML = "";
    souvenirs.forEach((s,index)=>{
      const div = document.createElement("div");
      div.className = "souvenir";

      const check = document.createElement("input");
      check.type = "checkbox";
      check.dataset.index = index;
      div.appendChild(check);

      if(s.photo){
        const img = document.createElement("img");
        img.src = s.photo;
        div.appendChild(img);
      }

      const content = document.createElement("div");
      content.innerHTML = `
        <div>${s.text}</div>
        <div style="font-size:12px;opacity:.7">Taille : ${s.size || "?"} cm ${sizeToEmoji(s.size)}</div>
        <div style="font-size:12px;opacity:.6">${s.date}</div>
      `;

      const actions = document.createElement("div");
      actions.className = "actions";

      const edit = document.createElement("button");
      edit.textContent = "Modifier";
      edit.className = "edit";
      edit.onclick = () => {
        document.getElementById("souvenirText").value = s.text;
        document.getElementById("souvenirDate").value = s.date;
        document.getElementById("babySizeInput").value = s.size || "";
        currentPhoto = s.photo;
        document.getElementById("photoPreview").innerHTML = s.photo ? `<img src="${s.photo}">` : "";
        document.getElementById("addButton").textContent = "Mettre √† jour";
        editIndex = index;
      };

      const del = document.createElement("button");
      del.textContent = "Supprimer";
      del.className = "delete";
      del.onclick = () => {
        if(confirm("Supprimer ce souvenir ?")){
          souvenirs.splice(index,1);
          saveSouvenirsToLocalStorage();
          renderSouvenirList();
        }
      };

      actions.append(edit,del);
      content.appendChild(actions);
      div.appendChild(content);
      souvenirList.appendChild(div);
    });
  }

  function addSouvenir() {
    const souvenirText = document.getElementById("souvenirText").value;
    const souvenirDate = document.getElementById("souvenirDate").value;
    const babySizeInput = document.getElementById("babySizeInput").value;

    if(!souvenirText || !souvenirDate) return alert("Remplis tout ü§ç");

    const data = {
      text: souvenirText,
      date: souvenirDate,
      size: babySizeInput,
      photo: currentPhoto
    };

    if(editIndex !== null){
      souvenirs[editIndex] = data;
      editIndex = null;
      document.getElementById("addButton").textContent = "Ajouter le souvenir";
    } else {
      souvenirs.push(data);
    }

    // R√©initialiser les champs
    document.getElementById("souvenirText").value = "";
    document.getElementById("souvenirDate").value = "";
    document.getElementById("babySizeInput").value = "";
    document.getElementById("souvenirPhoto").value = "";
    document.getElementById("photoPreview").innerHTML = "";
    currentPhoto = null;

    saveSouvenirsToLocalStorage();
    renderSouvenirList();
  }

  function toggleSouvenirList() {
    const souvenirList = document.getElementById("souvenirList");
    souvenirList.style.display =
      souvenirList.style.display === "block" ? "none" : "block";
  }

  async function saveSouvenirsSelection() {
    const selected = Array.from(
      document.getElementById("souvenirList").querySelectorAll("input[type=checkbox]:checked")
    );

    if (!selected.length) return alert("S√©lectionne au moins un souvenir ü§ç");

    const exportBox = document.createElement("div");
    exportBox.style.position = "fixed";
    exportBox.style.top = "-9999px";
    exportBox.style.width = "360px";
    exportBox.style.padding = "20px";
    exportBox.style.background = "#fff";

    selected.forEach(cb => {
      const s = souvenirs[cb.dataset.index];
      const block = document.createElement("div");
      block.style.marginBottom = "16px";
      block.style.border = "1px solid #ddd";
      block.style.borderRadius = "12px";
      block.style.padding = "12px";

      if(s.photo){
        const img = document.createElement("img");
        img.src = s.photo;
        img.style.width = "100%";
        img.style.borderRadius = "10px";
        img.style.marginBottom = "8px";
        block.appendChild(img);
      }

      block.innerHTML += `
        <div>${s.text}</div>
        <div style="font-size:13px;opacity:.7">Taille : ${s.size || "?"} cm ${sizeToEmoji(s.size)}</div>
        <div style="font-size:12px;opacity:.6">${s.date}</div>
      `;
      exportBox.appendChild(block);
    });

    document.body.appendChild(exportBox);
    const canvas = await html2canvas(exportBox,{scale:2,backgroundColor:"#fff"});
    document.body.removeChild(exportBox);

    const imgData = canvas.toDataURL("image/jpeg",1.0);
    document.getElementById("modalImage").src = imgData;
    document.getElementById("imageModal").style.display = "block";
  }

  function downloadImage() {
    const imgData = document.getElementById("modalImage").src;
    const a = document.createElement("a");
    a.href = imgData;
    a.download = "souvenirs.jpeg";
    a.click();
  }

  // Page 5: Journal
  function initJournalPage() {
    const saveButton = document.getElementById("saveNote");
    saveButton.addEventListener("click", saveJournalEntry);
    
    // Charger les entr√©es depuis localStorage
    const savedJournal = localStorage.getItem("journalEntries");
    if (savedJournal) {
      journalEntries = JSON.parse(savedJournal);
      renderJournalEntries();
    }
  }

  function saveJournalEntry() {
    const noteInput = document.getElementById("note");
    const dateInput = document.getElementById("journalDate");
    const emotionSelect = document.getElementById("emotion");
    const authorSelect = document.getElementById("author");
    const journal = document.getElementById("journal");

    if(!noteInput.value || !dateInput.value || !authorSelect.value) {
      alert("Remplis la note, la date et l'auteur ü§ç");
      return;
    }

    const newEntry = {
      date: dateInput.value,
      emotion: emotionSelect.value,
      author: authorSelect.value,
      text: noteInput.value,
      id: Date.now()
    };

    journalEntries.push(newEntry);
    saveJournalToLocalStorage();

    const noteCard = createNoteCard(newEntry);
    journal.prepend(noteCard);

    // Reset
    noteInput.value = "";
    dateInput.value = "";
    emotionSelect.value = "";
    authorSelect.value = "";
  }

  function createNoteCard(entry) {
    const noteCard = document.createElement("div");
    noteCard.className = "note-card";
    noteCard.dataset.id = entry.id;

    noteCard.innerHTML = `
      <div><strong>Date :</strong> <span class="date-text">${entry.date}</span></div>
      <div><strong>√âmotion :</strong> <span class="emotion-text">${entry.emotion || "--"}</span></div>
      <div><strong>Auteur :</strong> <span class="author-text">${entry.author}</span></div>
      <div class="note-text">${entry.text}</div>
      <div class="actions">
        <button class="edit">Modifier</button>
        <button class="delete">Supprimer</button>
      </div>
    `;

    // Supprimer
    noteCard.querySelector(".delete").addEventListener("click", () => {
      journalEntries = journalEntries.filter(e => e.id !== entry.id);
      saveJournalToLocalStorage();
      noteCard.remove();
    });

    // Modifier
    noteCard.querySelector(".edit").addEventListener("click", () => {
      document.getElementById("note").value = noteCard.querySelector(".note-text").innerText;
      document.getElementById("journalDate").value = noteCard.querySelector(".date-text").innerText;
      document.getElementById("emotion").value = noteCard.querySelector(".emotion-text").innerText;
      document.getElementById("author").value = noteCard.querySelector(".author-text").innerText;

      journalEntries = journalEntries.filter(e => e.id !== entry.id);
      saveJournalToLocalStorage();
      noteCard.remove();
    });

    return noteCard;
  }

  function renderJournalEntries() {
    const journal = document.getElementById("journal");
    journal.innerHTML = "";
    
    // Trier par date (plus r√©cent d'abord)
    journalEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    journalEntries.forEach(entry => {
      const noteCard = createNoteCard(entry);
      journal.appendChild(noteCard);
    });
  }

  // Fonctions de sauvegarde dans localStorage
  function loadFromLocalStorage() {
    // Les donn√©es sont charg√©es dans chaque fonction d'initialisation
  }

  function saveSouvenirsToLocalStorage() {
    localStorage.setItem("souvenirs", JSON.stringify(souvenirs));
  }

  function saveJournalToLocalStorage() {
    localStorage.setItem("journalEntries", JSON.stringify(journalEntries));
  }
</script>
</body>
</html>
